{% extends "base.html" %}

{% block title %}Ecoinvernadero{% endblock %}


{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ecoinvernadero/tasks.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/ecoinvernadero/simulacion.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/ecoinvernadero/resize.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/ecoinvernadero/instructions.css') }}">
{% endblock %}

{% block content %}

<div class="root">
    <div id="resizeOverlay">
        <div class="resize-message">
            <h2>⚠️ Pantalla demasiado pequeña</h2>
            <p>Amplía la ventana para continuar usando el simulador.</p>
        </div>
    </div>

    <div class="main-container">
        <div class="canvas-container">
            <canvas id="fixedCanvas"></canvas>
            <canvas id="connectionCanvas"></canvas>
        </div>

        <div class="workspace" id="workspace">
            <!-- Cuadro de tareas -->
            <div id="taskBox" class="task-box">
                <h3>Tareas</h3>
                <ul id="taskList">
                    <li data-task="ultrasonido">Conectar Arduino con Ultrasonido</li>
                    <li data-task="dht11">Conectar Arduino con DHT11</li>
                    <li data-task="higrometro">Conectar Arduino con Higrómetro</li>
                    <li data-task="rele">Conectar Arduino con Relé</li>
                </ul>
            </div>

            <!-- Componentes en el workspace -->
            <div id="workspace-arduino" class="placed-component grayscale" data-component="arduino">
                <img src="/static/assets/sprites/componentes/arduino_C.png" alt="Arduino"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%2300979D%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
            </div>

            <div id="workspace-ultrasonido" class="placed-component grayscale" data-component="ultrasonido">
                <img src="/static/assets/sprites/componentes/ultrasonido_C.png" alt="Ultrasonido"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234A90E2%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
            </div>

            <div id="workspace-higrometro" class="placed-component grayscale" data-component="higrometro">
                <img src="/static/assets/sprites/componentes/higrometro_C.png" alt="Higrómetro"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23795548%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
            </div>

            <div id="workspace-bomba" class="placed-component grayscale" data-component="bomba">
                <img src="/static/assets/sprites/componentes/electrobomba_C.png" alt="Bomba"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%232196F3%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
            </div>

            <div id="workspace-rele" class="placed-component grayscale" data-component="rele">
                <img src="/static/assets/sprites/componentes/rele_C.png" alt="Relé"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23FF5722%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
            </div>

            <div id="workspace-dht11" class="placed-component grayscale" data-component="dht11">
                <img src="/static/assets/sprites/componentes/DTH11_C.png" alt="DHT11"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234CAF50%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
            </div>

            <div id="workspace-protoboard" class="placed-component grayscale" data-component="protoboard">
                <img src="/static/assets/sprites/componentes/protoboard_C.png" alt="Protoboard"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23FFC107%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
            </div>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="components-grid">
            <div class="component-item" data-component="arduino">
                <img src="/static/assets/sprites/componentes/arduino_C.png" alt="Arduino" class="component-image"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%2300979D%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
                <div class="component-label">Arduino</div>
            </div>

            <div class="component-item" data-component="ultrasonido">
                <img src="/static/assets/sprites/componentes/ultrasonido_C.png" alt="Ultrasonido"
                    class="component-image"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234A90E2%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
                <div class="component-label">Ultrasonido</div>
            </div>

            <div class="component-item" data-component="higrometro">
                <img src="/static/assets/sprites/componentes/higrometro_C.png" alt="Higrómetro" class="component-image"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23795548%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
                <div class="component-label">Higrómetro</div>
            </div>

            <div class="component-item" data-component="bomba">
                <img src="/static/assets/sprites/componentes/electrobomba_C.png" alt="Bomba" class="component-image"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%232196F3%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
                <div class="component-label">Bomba</div>
            </div>

            <div class="component-item" data-component="rele">
                <img src="/static/assets/sprites/componentes/rele_C.png" alt="Relé" class="component-image"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23FF5722%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
                <div class="component-label">Relé</div>
            </div>

            <div class="component-item" data-component="dht11">
                <img src="/static/assets/sprites/componentes/DTH11_C.png" alt="DHT11" class="component-image"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234CAF50%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
                <div class="component-label">DHT11</div>
            </div>

            <div class="component-item" data-component="protoboard">
                <img src="/static/assets/sprites/componentes/protoboard_C.png" alt="Protoboard" class="component-image"
                    onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23FFC107%22 width=%22100%22 height=%22100%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22white%22/></svg>'">
                <div class="component-label">Protoboard</div>
            </div>
        </div>

        <div class="buttons-container">
            <button class="action-btn btn-limpiar" onclick="limpiar()">Limpiar</button>
            <button class="action-btn btn-iniciar" onclick="iniciarSimulacion()">Iniciar</button>
        </div>
    </div>

    <button class="toggle-btn" id="toggleBtn" onclick="toggleSidebar()">
        <span id="arrow">&#8249;</span>
    </button>

    <!-- Panel de información -->
    <div class="info-panel" id="infoPanel">
        <div class="info-panel-header">
            <h2 id="infoPanelTitle">Componente</h2>
            <button class="close-btn" onclick="closeInfoPanel()">&times;</button>
        </div>
        <div class="info-panel-content" id="infoPanelContent">
            <p><strong>Descripción:</strong> Información del componente</p>
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="confirm-modal" id="confirmModal">
        <h3>Confirmar Conexión</h3>
        <p id="confirmMessage">¿Desea conectar estos componentes?</p>
        <div class="confirm-modal-buttons">
            <button class="confirm-btn yes" onclick="confirmConnection(true)">Sí</button>
            <button class="confirm-btn no" onclick="confirmConnection(false)">No</button>
        </div>
    </div>

    <!-- Modal de conexión incorrecta -->
    <div class="error-modal" id="errorModal">
        <h3>❌ Conexión Incorrecta</h3>
        <p id="errorMessage">Los componentes seleccionados no pueden conectarse.</p>
        <button class="confirm-btn yes" onclick="closeErrorModal()">Continuar</button>
    </div>


    <!-- Panel de pasos para conexión -->
    <!-- 🔹 PANEL DE PASOS PARA CONEXIÓN -->
    <div id="connectionSteps" class="steps-panel">
        <div class="steps-content">
            <h2 id="stepsTitle" class="steps-title"><span id="compNameTitleO">Arduino</span> — <span
                    id="compNameTitle">Componente</span></h2>

            <div id="stepsContainer" class="steps-container fade-in">
                <div class="step active" id="step1">
                    <p>Vamos a programa tu <strong>Arduino</strong> con los demás componentes para tu invernadero.
                        Abre tu Arduino IDE y crea un nuevo proyecto.
                    </p>
                    <img id="img1" src="" alt="Paso 1">
                </div>

                <div class="step" id="step2">
                    <p id="connectionText">Define esto en el inicio de tu codigo,
                        Asegurate de estar por fuera del tu '<strong>void</strong> setup()' o tu '<strong>void</strong>
                        loop()'.
                        y asegurate que los pines coincidan con los que usaste.
                    </p>
                    <img id="img2" src="" alt="Paso 2">
                </div>

                <div class="step" id="step3">
                    <p>Vamos a tu <strong>void</strong> setup()
                        y agrega esto para inicializar los componentes.
                    </p>
                    <img id="img3" src="" alt="Paso 3">
                </div>

                <div class="step" id="step4">
                    <p>Por último agrega esto en tu<strong>void</strong> loop()
                    </p>
                    <img id="img4" src="" alt="Paso 4">
                </div>
            </div>

            <div class="steps-buttons">
                <button id="prevBtn" class="step-btn hidden" onclick="prevStep()">Volver</button>
                <button id="nextBtn" class="step-btn" onclick="nextStep()">Siguiente</button>
                <button id="confirmBtn" class="step-btn hidden" onclick="confirmFinal()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- 🔹 Modal de estado de conexiones -->
    <div id="statusOverlay" class="status-overlay">
        <div class="info-panel" id="statusPanel">
            <div class="info-panel-header">
                <h2 id="statusTitle">Estado de Conexiones</h2>
                <button class="close-btn" onclick="closeStatusPanel()">&times;</button>
            </div>
            <div class="info-panel-content" id="statusContent">
                <p id="statusMessage"></p>
                <button id="continueBtn" class="step-btn hidden" onclick="goToMonitor()">Continuar</button>
            </div>
        </div>
    </div>
    <script>
        // Flask genera la URL de manera segura aquí
        const ecoinvernaderoUrl = "{{ url_for('routes.ecoinvernadero') }}";
    </script>

</div>

<script src="{{ url_for('static', filename='js/ecoinvernadero/resize.js') }}"></script>
<script src="{{ url_for('static', filename='js/ecoinvernadero/instructions.js') }}"></script>
<script src="{{ url_for('static', filename='js/ecoinvernadero/simulacion.js') }}"></script>


{% endblock %}